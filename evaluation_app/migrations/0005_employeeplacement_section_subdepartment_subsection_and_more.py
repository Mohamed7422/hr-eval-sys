# Generated by Django 5.2.1 on 2025-08-26 15:53

import django.db.models.deletion
import django.utils.timezone
import uuid
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('evaluation_app', '0004_remove_evaluation_competencies_and_more'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='EmployeePlacement',
            fields=[
                ('placement_id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('assigned_at', models.DateTimeField(default=django.utils.timezone.now)),
            ],
        ),
        migrations.CreateModel(
            name='Section',
            fields=[
                ('section_id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('name', models.CharField(max_length=120)),
                ('employee_count', models.PositiveIntegerField(default=0)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
        ),
        migrations.CreateModel(
            name='SubDepartment',
            fields=[
                ('sub_department_id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('name', models.CharField(max_length=120)),
                ('employee_count', models.PositiveIntegerField(default=0)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
        ),
        migrations.CreateModel(
            name='SubSection',
            fields=[
                ('sub_section_id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('name', models.CharField(max_length=120)),
                ('employee_count', models.PositiveIntegerField(default=0)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
        ),
        migrations.AlterUniqueTogether(
            name='department',
            unique_together=set(),
        ),
        migrations.AddField(
            model_name='employee',
            name='branch',
            field=models.CharField(blank=True, choices=[('OFFICE', 'Office'), ('STORE', 'Store')], default='OFFICE', max_length=20, null=True),
        ),
        migrations.AddField(
            model_name='employee',
            name='client_employee_code',
            field=models.CharField(blank=True, max_length=120, null=True, default=None),
        ),
        migrations.AddField(
            model_name='employee',
            name='job_type',
            field=models.CharField(blank=True, choices=[('FULL_TIME', 'Full-time'), ('PART_TIME', 'Part-time'), ('FULL_TIME_REMOTE', 'Full-time Remote'), ('PART_TIME_REMOTE', 'Part-time Remote')], default='FULL_TIME', max_length=20, null=True),
        ),
        migrations.AddField(
            model_name='employee',
            name='location',
            field=models.CharField(blank=True, max_length=180),
        ),
        migrations.AddField(
            model_name='employee',
            name='warning',
            field=models.JSONField(blank=True, default=list),
        ),
        migrations.AddField(
            model_name='employee',
            name='warning_count',
            field=models.PositiveSmallIntegerField(default=0),
        ),
        migrations.AlterField(
            model_name='department',
            name='employee_count',
            field=models.PositiveIntegerField(default=0),
        ),
        migrations.AddConstraint(
            model_name='department',
            constraint=models.UniqueConstraint(fields=('company', 'name'), name='uniq_dept_per_company'),
        ),
        migrations.AddConstraint(
            model_name='employee',
            constraint=models.UniqueConstraint(
                condition=(
                    models.Q(('client_employee_code__isnull', False)) &
                    models.Q(('client_employee_code', ''), _negated=True)
                    ),
                fields=('company', 'client_employee_code'), 
                name='uniq_client_emp_code_per_company'),
        ),
        migrations.AddField(
            model_name='employeeplacement',
            name='company',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='company_placements', to='evaluation_app.company'),
        ),
        migrations.AddField(
            model_name='employeeplacement',
            name='department',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='department_placements', to='evaluation_app.department'),
        ),
        migrations.AddField(
            model_name='employeeplacement',
            name='employee',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='employee_placements', to='evaluation_app.employee'),
        ),
        migrations.AddField(
            model_name='section',
            name='manager',
            field=models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='managed_sections', to=settings.AUTH_USER_MODEL),
        ),
        migrations.AddField(
            model_name='employeeplacement',
            name='section',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='section_placements', to='evaluation_app.section'),
        ),
        migrations.AddField(
            model_name='subdepartment',
            name='department',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='sub_departments', to='evaluation_app.department'),
        ),
        migrations.AddField(
            model_name='subdepartment',
            name='manager',
            field=models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='managed_sub_departments', to=settings.AUTH_USER_MODEL),
        ),
        migrations.AddField(
            model_name='section',
            name='sub_department',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='sections', to='evaluation_app.subdepartment'),
        ),
        migrations.AddField(
            model_name='employeeplacement',
            name='sub_department',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='sub_department_placements', to='evaluation_app.subdepartment'),
        ),
        migrations.AddField(
            model_name='subsection',
            name='manager',
            field=models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='managed_sub_sections', to=settings.AUTH_USER_MODEL),
        ),
        migrations.AddField(
            model_name='subsection',
            name='section',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='sub_sections', to='evaluation_app.section'),
        ),
        migrations.AddField(
            model_name='employeeplacement',
            name='sub_section',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='sub_section_placements', to='evaluation_app.subsection'),
        ),
        migrations.AddConstraint(
            model_name='subdepartment',
            constraint=models.UniqueConstraint(fields=('department', 'name'), name='uniq_subdept_per_dept'),
        ),
        migrations.AddConstraint(
            model_name='section',
            constraint=models.UniqueConstraint(fields=('sub_department', 'name'), name='uniq_section_per_subdept'),
        ),
        migrations.AddConstraint(
            model_name='subsection',
            constraint=models.UniqueConstraint(fields=('section', 'name'), name='uniq_subsection_per_section'),
        ),
        migrations.AddConstraint(
            model_name='employeeplacement',
            constraint=models.UniqueConstraint(condition=models.Q(('department__isnull', False)), fields=('employee', 'department'), name='uniq_emp_dept'),
        ),
        migrations.AddConstraint(
            model_name='employeeplacement',
            constraint=models.UniqueConstraint(condition=models.Q(('sub_department__isnull', False)), fields=('employee', 'sub_department'), name='uniq_emp_subdept'),
        ),
        migrations.AddConstraint(
            model_name='employeeplacement',
            constraint=models.UniqueConstraint(condition=models.Q(('section__isnull', False)), fields=('employee', 'section'), name='uniq_emp_section'),
        ),
        migrations.AddConstraint(
            model_name='employeeplacement',
            constraint=models.UniqueConstraint(condition=models.Q(('sub_section__isnull', False)), fields=('employee', 'sub_section'), name='uniq_emp_subsect'),
        ),
        migrations.AddConstraint(
            model_name='employeeplacement',
            constraint=models.CheckConstraint(condition=models.Q(models.Q(('department__isnull', False), ('sub_department__isnull', True), ('section__isnull', True), ('sub_section__isnull', True)), models.Q(('department__isnull', True), ('sub_department__isnull', False), ('section__isnull', True), ('sub_section__isnull', True)), models.Q(('department__isnull', True), ('sub_department__isnull', True), ('section__isnull', False), ('sub_section__isnull', True)), models.Q(('department__isnull', True), ('sub_department__isnull', True), ('section__isnull', True), ('sub_section__isnull', False)), _connector='OR'), name='exactly_one_org_unit'),
        ),
    ]
